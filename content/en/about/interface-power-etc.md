---
title: "什么是接口幂等，接口幂等如何保证"
linkTitle: "什么是接口幂等，接口幂等如何保证"
date: 2022-05-08
weight: 202205081622
---

### 1.什么是接口幂等？

幂等性原本是数学上的概念，用在接口上就可以理解为：对于同一操作发起的一次请求或者多次请求的结果是一致的。不会因为多次请求而产生副作用。例如：服务消费MQ消息，MQ生产者发送了多个相同消息体的MQ消息，消费这个消息的接口多次消费相同的消息结果应该一样。不会因为多消费几次而产生调记录。

接口幂等主要发生在一下两类接口：

- 插入数据接口，多次请求可能产生多个数据

- 更新接口，多次更新可能导致数据混乱，例如：

  ```sql
   UPDATE mxsm_allocation
          SET max_id = max_id + step * #{stepLength}
          WHERE biz_code = #{bizCode}
  ```

### 2.接口幂等解决方案

下面来看一下在日常工作中经常用到的接口幂等的解决方案：

![接口幂等方案](https://raw.githubusercontent.com/mxsm/picture/main/about/%E6%8E%A5%E5%8F%A3%E5%B9%82%E7%AD%89%E6%96%B9%E6%A1%88.png)

#### 2.1 数据库主键/唯一索引

数据库主键/唯一索引主要是利用数据库的特性，相同主键和唯一索引的数据插入数据库直接抛错。流程如下：



**优点：**

- 实现简单只是依赖数据库

**缺点：**

- 如果数据库中的数据存在软删除，那么数据库表就不能创建唯一索引。利用唯一索引做幂等就不能使用。
- 如果数据库表的ID每次都是生成，那么数据库主键接口幂也不适用。

在上面的缺点中提到了数据如果存在软删除，数据表建立

### 3. 总结