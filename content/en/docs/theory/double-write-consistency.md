---
title: "缓存与数据库双写数据一致性问题"
linkTitle: "缓存与数据库双写数据一致性问题"
date: 2022-05-16
weight: 202205162223
---

在分布式的开发中引入缓存是很常见的，缓存的引入能够提高接口的响应速度。但是缓存的引入同时也增加了系统的复杂度，会带来一些新的问题。例如我们下面要讲的 **`缓存与数据库双写数据一致性问题`** 。我们以Redis缓存和MySQL数据库为例，在双写的情况下存在的问题以及解决方式。本文会从下图所示的几个方面来讲解：

//TODO 图  https://www.liuchengtu.com/swdt/#X0b62b25ab532fe9ed9a4d053a3161912

### 1. 数据一致性

对于数据的一致性从两个方面讲解：

- 数据的一致性分类
- 分布式一致性理论

#### 1.1 数据一致性分类

数据一致性主要可以分为一下几类，如下图所示：

//https://www.liuchengtu.com/swdt/#X55dd720d00894ae0593767ec6380a46c

**强一致性：**

- 任何一次都能读到某个数据最近一次写的数据
- 系统中的所有进程，看到的操作顺序，都和全局时钟下的顺序一致

换一句说就是：数据写入后后续不管是哪个进程来读数据都是一样的。分布式系统中就是所有节点的数据都一样。例如关系型数据库中就是强一致性，更新过的数据被后续的访问都能看到。

**弱一致性：**数据更新后如果能够容忍部分节点或者进程能够访问到数据或者全部访问不到数据，这种就是弱一致性。

**最终一致性：**不保证在任意时刻任意节点上的同一份数据都是相同的，但是随着时间的迁移，不同节点上的同一份数据总是在向趋同的方向变化。换句话说：在一段时间后节点的数据最终会达到一致状态。例如DNS服务器，当你更改域名和IP的绑定关系，随着时间的推移最终所有的DNS服务器都会变更成最终的状态。

![幂等方案2](E:\download\幂等方案2.png)







参考资料：

- https://cloud.google.com/datastore/docs/articles/balancing-strong-and-eventual-consistency-with-google-cloud-datastore?hl=zh-cn#what-is-eventual-consistency
- https://www.1024sou.com/article/137996.html
- https://blog.nowcoder.net/n/bd9041ddc8314dd9946957dd9999d4de?from=nowcoder_improve