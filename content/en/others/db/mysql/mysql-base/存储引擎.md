---
title: 存储引擎
categories:
  - 数据库
  - MYSQL
  - mysql
tags:
  - 数据库
  - MYSQL
  - mysql
abbrlink: b2aef391
date: 2018-08-16 17:46:00
---
### 1. MyISAM存储引擎

- **特点：**
  - **不支持行锁(MyISAM只有表锁)**，读取时对需要读到的所有表加锁，写入时则对表加排他锁.
  - **不支持事务**
  - **不支持外键**
  - **不支持崩溃后的安全恢复**
  - 在表有读取查询的同时，支持往表中插入新纪录
  - 支持BLOB和TEXT的前500个字符索引，**支持全文索引**
  - **支持延迟更新索引**
  - 对于不会进行修改的表，支持 **压缩表** ，极大地减少了磁盘空间的占用
- **存储格式**
  - **`.frm`** 文件存储表定义
  - **`.MYD`** 文件存储数据文件
  - **`.MYI`** 文件存储索引文件

**行锁表锁**

```
Mysql的行锁和表锁（ 锁是计算机协调多个进程或纯线程并发访问某一资源的机制）
表级锁： 每次操作锁住整张表。开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低；
行级锁： 每次操作锁住一行数据。开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高；
```

- **索引的实现：**

  **MyISAM 索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。**

  - **主键索引的实现**

    ![图解](https://github.com/mxsm/document/blob/master/image/database/myisamprimarykeyimplments.png?raw=true)

  - **辅助索引：**

    ![图片](https://github.com/mxsm/document/blob/master/image/database/myisamsecondarykeyimplments.png?raw=true)

在MyISAM中，主索引和辅助索引（Secondary key）在结构上没有任何区别。只是主索引要求key是唯一的，而辅助索引的key可以重复。**data域保存数据记录的地址，因为数据文件和索引文件是分开的。**

**MyISAM** 中索引检索的算法为首先按照 **B+Tree** 搜索算法搜索索引，如果指定的Key存在，则取出其data域的值，然后以data域的值为地址，读取相应数据记录。

MyISAM的索引方式也叫做“**非聚集**”的，之所以这么称呼是为了与InnoDB的聚集索引区分。

#### 知识点补充

```
什么叫非聚集索引？
非聚集索引索引项顺序存储，但索引项对应的内容却是随机存储的；
什么是聚集索引？
聚集索引表记录的排列顺序与索引的排列顺序一致
```

### 2. InnoDB

- **特点：**
  - **支持行锁**，采用MVCC来支持高并发，有可能死锁。
  - 支持事务
  - 支持外键
  - **支持崩溃后的安全恢复**
  - **不支持全文索引**

- **索引的实现**

  **`InnoDB`** 和 **`MyISAM`** 一样索引都是用的 **`B+Tree`** 作为索引的结构。 但是具体的实现不一样。

  - **InnoDB的数据文件本身就是索引文件**

    MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。而在InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引。

    ![图](https://box.kancloud.cn/2015-07-07_559b7873b514d.png)

    从上图可以看出叶子节点包含了完整的数据记录。这种索引叫做 **聚集索引** 。因为 **`InnoDB`** 的数据文件本身要按主键聚集，所以 **`InnoDB`** 要求表必须有主键（MyISAM可以没有）。所以在建表的过程中会要求我们选择一列作为主键。

     第二个与MyISAM索引的不同是**InnoDB的辅助索引data域存储相应记录主键的值而不是地址** 。换句话说，InnoDB的所有辅助索引都引用主键作为data域。

    ![图](https://box.kancloud.cn/2015-07-07_559b7873ceaf1.png)

    **辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。** 为什么不建议使用过长的字段作为主键：辅助索引都引用主索引，过长的主索引会令辅助索引变得过大。

参考：

https://www.kancloud.cn/kancloud/theory-of-mysql-index/41851

