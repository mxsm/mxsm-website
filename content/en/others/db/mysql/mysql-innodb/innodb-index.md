---
title: "mysql innodb 索引"
linkTitle: "mysql innodb 索引"
weight: 4
date: 2021-02-25 20:32:00
---

### Innodb存储引擎索引
- B+树索引
- 全文索引
- Hash索引

### B+树索引
B+树索引就是传统意义上的索引，这是目前关系型数据库中查找最为常用和最为有效的索引。B+树索引的构造类似于二叉树，根据键值快速找到数据。
> B+树中的B不是代表二叉，而是代表平衡。 B+树索引不能找到一个给定键值的具体行。B+树索引能找到的只是被查找数据行所在的页。然后数据库通过把页读入内存，再在内存中进行查找，最后得到要查找的数据。

### B+树数据结构

### B+树索引
B+树索引本质就是B+树在数据库中的实现。但是B+树索引在数据库中有一个特点是高扇出性。一般数据库中，B+树的高度一般都在2-4层。也就是说查找某个键值的行记录时最多需要2到4次IO。  
索引的分类：
- 聚集索引
- 辅助索引  
不管是聚集索引还是辅助索引，内部都是B+树，也就是高度平衡，叶子节点存放着数据。不同的是:叶子节点存放的是否是一整行的信息数据。

### 聚集索引
InnoDB存储引擎表是索引组织表，表中数据按照主键顺序存放。聚集索引就是按照每张表的主键构造一颗B+树，同时叶子节点中存放的即为整张表的行记录数据，聚集索引的这个特性决定了组织表中数据也是索引的一部分。同B+树数据结构一样。每个数据也通过一个双向链表来进行连接。
> 每张表只能拥有一个聚集索引(主键只能一个)

#### 聚集索引的好处

1. 由于定义了数据的逻辑顺序，聚集索引能够特别快的方位针对范围值的查询
2. 主键的排序查找和范围查找速度特别快。


### 辅助索引
叶子节点不包含行记录的全部数据。叶子节点除了包含键值以外每个叶子节点的索引中还包含了一个书签，该书签用来告诉InnoDB哪里可以找到与索引相对应的行数据。
> 由于InnoDB表是索引组织表，因此InnoDB辅助索引的书签就是相对应行数据的聚集索引键

![辅助索引与聚集索引的关系](https://github.com/mxsm/picture/blob/main/mysql/%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95%E5%92%8C%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E7%9A%84%E5%85%B3%E7%B3%BB.png?raw=true)

辅助索引的存在并不影响数据在聚集索引中的组织，因此每张表上可以有多个辅助索引。通过辅助索引来查找数据时，InnoDB存储引擎会遍历辅助索引并通过叶级别的指针获取指向主键索引的主键键值，然后通过主键索引来找到完整的行记录。  
例如：一棵高度为3的辅助索引树中查找数据，那么需要对这颗树遍历3次找到指定主键键值。如果聚集索引同样高度为3，那么对聚集索引树进行3次查找，最终找到文字的数据所在页，因此一共需要6次逻辑IO访问得到最终的一个数据页。

### Hash索引
InnoDB存储引擎使用哈希算法来对字典来进行查找，其冲突机制采用链表方式，哈希函数采用除法散列方式。

### 全文检索
全文检索通过使用倒排索引来实现。