---
title: 数据库事务
categories:
  - 数据库
tags:
  - 数据库
abbrlink: '587418e1'
date: 2018-10-31 15:27:08
---
### 数据库事务的四大特性(ACID)

- **原子性(atomicity):一个事务必须视为一个不可分割的最小单元，整个事务中的所有操作要么全部提交成功，要么全部失败回滚，对于一个事务来说，不可能只执行成功其中的一部分操作，这就是事务的原子性.**
- **一致性(consistency)：数据总是从一个一致性的状态转换到另一个一致性的状态。**
- **隔离性（isolation）：一个事务所做的修改在最终提交以前，对其他事务是不可见的，多个并发事务之间是相互隔离的。关于事务的隔离性，MySQL提供了四种隔离级别。**
- **持久性（durability）：一旦事务提交，所做的修改会永久保存到数据库中。即使系统崩溃，修改的数据也不会丢失。**

###  不考虑隔离性可能产生的问题

- #### 脏读

  脏读是指在一个事务处理过程中读取了另一个未提交的事务中的数据。

- #### 不可重复读

  不可重复读是指对于数据库中的某个数据，一个事务内多次查询却返回了不同的数据值，这是由于在事务执行过程中，数据被另一个事务修改并提交了。

- #### 幻读

  幻读是事务非独立执行时发生的一种现象。例如，事务T1对一个表中所有的行的某个字段做了从“1”修改为“2”的操作，这时事务T2又插入了一条新的记录，而该字段的值为“1”并且提交给数据库。这时，操作事务T1的用户如果再查看刚刚修改的数据，会发现还有一行没有修改，其实这行是从事务T2中添加的，就好像产生幻觉一样，这就是产生了幻读。

#### 幻读和不可重复读的区别：

- **幻读针对的是一批数据（比如数据的个数）重点在于新增或者删除操作**
- **不可重复读查询的都是同一个数据项 重点在于更新操作**

**相同点都是读取了另一条提交的事物**

### 事务的隔离级别

- ##### Serializable（串行化）：可避免脏读、不可重复读、幻读的发生。（级别最高）

- ##### Repeatable-read（可重复读）：可避免脏读、不可重复读的发生。

- ##### Read-committed（读已提交）：可避免脏读的发生。

- ##### Read-uncommitted（读未提交）：最低级别，任何情况都无法保证。（级别最低）

MySQL的InnoDB默认为 **`Repeatable-read`**

