---
title: "Rocketmq消息任意时间延迟优化"
sidebar_label: Rocketmq消息任意时间延迟优化
linkTitle: "Rocketmq消息任意时间延迟优化"
weight: 202308122155
description: Rocketmq消息任意时间延迟优化
---

## 1. What do we need to do

现在Rocketmq已经支持了消息的任意时间延迟，但是在现有的情况下时间轮的slot是固定 7 * 24 * 3600个以时间精度为秒来计算，在不进行时间轮不转一圈的情况下可以支持七天的消息延迟，当伴随着超过七天的就会再之前的slot位置产生链表的数据。随着要求延迟的时间越来越长会导致对应的slot的链表也越来越长。与此同时现在的方式会将链表上面所有的数据读取到内存然后判断是否到时间需要进行消费，如果没有就重新写入CommitLog中，这样导致了重复写入的问题。同时也造成了需要重新读取数据到

## 2 目标

1. 减少重复从CommitLog读入的消息
2. 减少重复写入CommitLog的延迟消息
3. 减少在遍历消息时候的数据处理时间

## 3 设计分层时间轮来解决